{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//import $, { error } from 'jquery';\nimport $ from 'jquery';\nimport * as Repository from 'block_eledia_telc_coursesearch/repository';\nimport * as PagedContentFactory from 'core/paged_content_factory';\nimport * as PubSub from 'core/pubsub';\nimport * as CustomEvents from 'core/custom_interaction_events';\nimport * as Notification from 'core/notification';\nimport { exception as displayException } from 'core/notification';\nimport * as Templates from 'core/templates';\nimport * as CourseEvents from 'core_course/events';\nimport SELECTORS from 'block_eledia_telc_coursesearch/selectors';\nimport * as PagedContentEvents from 'core/paged_content_events';\nimport * as Aria from 'core/aria';\nimport { debounce } from 'core/utils';\nimport { setUserPreference } from 'core_user/repository';\n\nconst TEMPLATES = {\n    COURSES_CARDS: 'block_eledia_telc_coursesearch/view-cards',\n    COURSES_LIST: 'block_eledia_telc_coursesearch/view-list',\n    COURSES_SUMMARY: 'block_eledia_telc_coursesearch/view-summary',\n    NOCOURSES: 'core_course/no-courses'\n};\n\nconst GROUPINGS = {\n    GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n    GROUPING_ALL: 'all',\n    GROUPING_INPROGRESS: 'inprogress',\n    GROUPING_FUTURE: 'future',\n    GROUPING_PAST: 'past',\n    GROUPING_FAVOURITES: 'favourites',\n    GROUPING_HIDDEN: 'hidden'\n};\n\nconst NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\n\nlet loadedPages = [];\n\nlet courseOffset = 0;\n\nlet lastPage = 0;\n\nlet lastLimit = 0;\n\nlet namespace = null;\n\nlet selectedCategories = [];\nlet selectableCategories = [];\nlet selectedTags = [];\nlet selectableTags = [];\nlet customfields = [];\nlet filteredCustomfields = [];\nlet selectedCustomfields = [];\nlet searchTerm = '';\nlet catSearchTerm = '';\nlet tagsSearchTerm = '';\nlet courseInProgress = 'all';\nlet currentCustomField = 0;\n\nlet tagsReverseState = false;\nlet customReverseState = false;\nlet catReverseState = false;\n\n/**\n * Whether the summary display has been loaded.\n *\n * If true, this means that courses have been loaded with the summary text.\n * Otherwise, switching to the summary display mode will require course data to be fetched with the summary text.\n *\n * @type {boolean}\n */\nlet summaryDisplayLoaded = false;\n\n/**\n * Get filter values from DOM.\n *\n * @param {object} root The root element for the courses view.\n * @return {filters} Set filters.\n */\nconst getFilterValues = root => {\n    const courseRegion = root.find(SELECTORS.courseView.region);\n    return {\n        display: courseRegion.attr('data-display'),\n        grouping: courseRegion.attr('data-grouping'),\n        sort: courseRegion.attr('data-sort'),\n        displaycategories: courseRegion.attr('data-displaycategories'),\n        // TODO: Remove\n        customfieldname: courseRegion.attr('data-customfieldname'),\n        customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n    };\n};\n\n/**\n * Get filter values from DOM and global variables.\n *\n * @param {object} root The root element for the courses view.\n * @return {filters} Set filters.\n */\nconst getAllFilterValues = root => {\n    const courseRegion = root.find(SELECTORS.courseView.region);\n    return {\n        display: courseRegion.attr('data-display'),\n        grouping: courseRegion.attr('data-grouping'),\n        sort: courseRegion.attr('data-sort'),\n        displaycategories: courseRegion.attr('data-displaycategories'),\n        customfields: customfields,\n        selectedCategories: selectedCategories,\n    };\n};\n\n// We want the paged content controls below the paged content area.\n// and the controls should be ignored while data is loading.\nconst DEFAULT_PAGED_CONTENT_CONFIG = {\n    ignoreControlWhileLoading: true,\n    controlPlacementBottom: true,\n    persistentLimitKey: 'block_eledia_telc_coursesearch_user_paging_preference'\n};\n\n/**\n * Get enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @param {object} searchParams The params.\n * @return {promise} Resolved with an array of courses.\n */\nconst getMyCourses = (filters, limit, searchParams) => {\n    const params = {\n        offset: courseOffset,\n        limit: limit,\n        classification: filters.grouping,\n        sort: filters.sort,\n        customfieldname: filters.customfieldname,\n        customfieldvalue: filters.customfieldvalue,\n    };\n    if (filters.display === 'summary') {\n        params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\n        summaryDisplayLoaded = true;\n    } else {\n        params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\n    }\n    // return Repository.getEnrolledCoursesByTimeline(searchParams);\n    return Repository.getEnrolledCoursesByTimeline(searchParams);\n};\n\n/**\n * Search for enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @param {string} searchValue What does the user want to search within their courses.\n * @return {promise} Resolved with an array of courses.\n */\nconst getSearchMyCourses = (filters, limit, searchValue) => {\n    const params = {\n        offset: courseOffset,\n        limit: limit,\n        classification: 'search',\n        sort: filters.sort,\n        customfieldname: filters.customfieldname,\n        customfieldvalue: filters.customfieldvalue,\n        searchvalue: searchValue,\n    };\n    if (filters.display === 'summary') {\n        params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\n        summaryDisplayLoaded = true;\n    } else {\n        params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\n        summaryDisplayLoaded = false;\n    }\n    // return Repository.getEnrolledCoursesByTimeline(params);\n    return Repository.getEnrolledCoursesByTimeline(searchValue);\n};\n\n/**\n * Search for categories from backend.\n *\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchCategories = () => {\n    const params = getParams();\n    return Repository.getCategories(params);\n};\n\n/**\n * Search for tags from backend.\n *\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchTags = () => {\n    const params = getParams();\n    return Repository.getTags(params);\n};\n\n/**\n * Search for custom fields from backend.\n *\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchCustomfields = () => {\n    const params = getParams();\n    return Repository.getCustomfields(params);\n};\n\n/**\n * Get params for search\n *\n * @param {int} limit\n *\n * @return {Object} The favourite icon container\n */\nconst getParams = (limit = 0) => {\n    const params = {\n        criteria: [\n            {\n                key: \"categoryName\",\n                value: catSearchTerm,\n            },\n            {\n                key: \"tagsName\",\n                value: tagsSearchTerm,\n            },\n            {\n                key: 'name',\n                value: searchTerm,\n            },\n            {\n                key: 'selectedCategories',\n                categories: selectedCategories,\n            },\n            {\n                key: 'limit',\n                value: limit,\n            },\n            {\n                key: 'offset',\n                value: courseOffset,\n            },\n            {\n                key: 'progress',\n                value: courseInProgress,\n            },\n            {\n                key: 'currentCustomField',\n                value: currentCustomField,\n            },\n            {\n                key: 'selectedCustomfields',\n                customfields: getCustomFields(),\n            },\n            {\n                key: 'selectedTags',\n                tags: selectedTags,\n            },\n        ],\n        addsubcategories: true,\n    };\n    return params;\n};\n\n/**\n * Get params for search\n *\n * @return {Object} The favourite icon container\n */\nconst getCustomFields = () => {\n    if (!selectedCustomfields.length) {\n        return [];\n    }\n    const customFields = selectedCustomfields.map((values, key) => {\n        if (!values || values === undefined) {\n            return null;\n        }\n        const customValues = {\n            fieldid: key,\n            fieldvalues: values.map(val => val.value),\n        };\n        return customValues;\n    }).filter(Boolean);\n    return customFields;\n};\n\n/**\n * Get the container element for the favourite icon.\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n * @return {Object} The favourite icon container\n */\nconst getFavouriteIconContainer = (root, courseId) => {\n    return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the paged content container element.\n *\n * @param {Object} root The course overview container\n * @param {Number} index Rendered page index.\n * @return {Object} The rendered paged container.\n */\nconst getPagedContentContainer = (root, index) => {\n    return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n};\n\n/**\n * Get the course id from a favourite element.\n *\n * @param {Object} root The favourite icon container element.\n * @return {Number} Course id.\n */\nconst getCourseId = root => {\n    return root.attr('data-course-id');\n};\n\n/**\n * Hide the favourite icon.\n *\n * @param {Object} root The favourite icon container element.\n * @param {Number} courseId Course id number.\n */\nconst hideFavouriteIcon = (root, courseId) => {\n    const iconContainer = getFavouriteIconContainer(root, courseId);\n\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n    isFavouriteIcon.addClass('hidden');\n    Aria.hide(isFavouriteIcon);\n\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n    notFavourteIcon.removeClass('hidden');\n    Aria.unhide(notFavourteIcon);\n};\n\n/**\n * Show the favourite icon.\n *\n * @param {Object} root The course overview container.\n * @param {Number} courseId Course id number.\n */\nconst showFavouriteIcon = (root, courseId) => {\n    const iconContainer = getFavouriteIconContainer(root, courseId);\n\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n    isFavouriteIcon.removeClass('hidden');\n    Aria.unhide(isFavouriteIcon);\n\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n    notFavourteIcon.addClass('hidden');\n    Aria.hide(notFavourteIcon);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The add to favourite menu item.\n */\nconst getAddFavouriteMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The remove from favourites menu item.\n */\nconst getRemoveFavouriteMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Add course to favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst addToFavourites = (root, courseId) => {\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n    const addAction = getAddFavouriteMenuItem(root, courseId);\n\n    setCourseFavouriteState(courseId, true).then(success => {\n        if (success) {\n            PubSub.publish(CourseEvents.favourited, courseId);\n            removeAction.removeClass('hidden');\n            addAction.addClass('hidden');\n            showFavouriteIcon(root, courseId);\n        } else {\n            Notification.alert('Starring course failed', 'Could not change favourite state');\n        }\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Remove course from favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst removeFromFavourites = (root, courseId) => {\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n    const addAction = getAddFavouriteMenuItem(root, courseId);\n\n    setCourseFavouriteState(courseId, false).then(success => {\n        if (success) {\n            PubSub.publish(CourseEvents.unfavorited, courseId);\n            removeAction.addClass('hidden');\n            addAction.removeClass('hidden');\n            hideFavouriteIcon(root, courseId);\n        } else {\n            Notification.alert('Starring course failed', 'Could not change favourite state');\n        }\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The hide course menu item.\n */\nconst getHideCourseMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The show course menu item.\n */\nconst getShowCourseMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Hide course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst hideCourse = (root, courseId) => {\n    const hideAction = getHideCourseMenuItem(root, courseId);\n    const showAction = getShowCourseMenuItem(root, courseId);\n    const filters = getFilterValues(root);\n\n    setCourseHiddenState(courseId, true);\n\n    // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n        hideElement(root, courseId);\n    }\n\n    hideAction.addClass('hidden');\n    showAction.removeClass('hidden');\n};\n\n/**\n * Show course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst showCourse = (root, courseId) => {\n    const hideAction = getHideCourseMenuItem(root, courseId);\n    const showAction = getShowCourseMenuItem(root, courseId);\n    const filters = getFilterValues(root);\n\n    setCourseHiddenState(courseId, null);\n\n    // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n        hideElement(root, courseId);\n    }\n\n    hideAction.removeClass('hidden');\n    showAction.addClass('hidden');\n};\n\n/**\n * Set the courses hidden status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {Boolean} status new hidden status.\n * @return {Promise} Repository promise.\n */\nconst setCourseHiddenState = (courseId, status) => {\n\n    // If the given status is not hidden, the preference has to be deleted with a null value.\n    if (status === false) {\n        status = null;\n    }\n\n    return setUserPreference(`block_eledia_telc_coursesearch_hidden_course_${courseId}`, status)\n        .catch(Notification.exception);\n};\n\n/**\n * Reset the loadedPages dataset to take into account the hidden element\n *\n * @param {Object} root The course overview container\n * @param {Number} id The course id number\n */\nconst hideElement = (root, id) => {\n    const pagingBar = root.find('[data-region=\"paging-bar\"]');\n    const jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n    // Get a reduced dataset for the current page.\n    const courseList = loadedPages[jumpto];\n    let reducedCourse = courseList.courses.reduce((accumulator, current) => {\n        if (+id !== +current.id) {\n            accumulator.push(current);\n        }\n        return accumulator;\n    }, []);\n\n    // Get the next page's data if loaded and pop the first element from it.\n    if (typeof (loadedPages[jumpto + 1]) !== 'undefined') {\n        const newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n        // Adjust the dataset for the reset of the pages that are loaded.\n        loadedPages.forEach((courseList, index) => {\n            if (index > jumpto) {\n                let popElement = [];\n                if (typeof (loadedPages[index + 1]) !== 'undefined') {\n                    popElement = loadedPages[index + 1].courses.slice(0, 1);\n                }\n                loadedPages[index].courses = [...loadedPages[index].courses.slice(1), ...popElement];\n            }\n        });\n\n        reducedCourse = [...reducedCourse, ...newElement];\n    }\n\n    // Check if the next page is the last page and if it still has data associated to it.\n    if (lastPage === jumpto + 1 && loadedPages[jumpto + 1].courses.length === 0) {\n        const pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n        PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n    }\n\n    loadedPages[jumpto].courses = reducedCourse;\n\n    // Reduce the course offset.\n    courseOffset--;\n\n    // Render the paged content for the current.\n    const pagedContentPage = getPagedContentContainer(root, jumpto);\n    renderCourses(root, loadedPages[jumpto]).then((html, js) => {\n        return Templates.replaceNodeContents(pagedContentPage, html, js);\n    }).catch(Notification.exception);\n\n    // Delete subsequent pages in order to trigger the callback.\n    loadedPages.forEach((courseList, index) => {\n        if (index > jumpto) {\n            const page = getPagedContentContainer(root, index);\n            page.remove();\n        }\n    });\n};\n\n/**\n * Set the courses favourite status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {boolean} status new favourite status.\n * @return {Promise} Repository promise.\n */\nconst setCourseFavouriteState = (courseId, status) => {\n\n    return Repository.setFavouriteCourses({\n        courses: [\n            {\n                'id': courseId,\n                'favourite': status\n            }\n        ]\n    }).then(result => {\n        if (result.warnings.length === 0) {\n            loadedPages.forEach(courseList => {\n                courseList.courses.forEach((course, index) => {\n                    if (course.id == courseId) {\n                        courseList.courses[index].isfavourite = status;\n                    }\n                });\n            });\n            return true;\n        } else {\n            return false;\n        }\n    }).catch(Notification.exception);\n};\n\n/**\n * Given there are no courses to render provide the rendered template.\n *\n * @param {object} root The root element for the courses view.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst noCoursesRender = root => {\n    const nocoursesimg = root.find(SELECTORS.courseView.region).attr('data-nocoursesimg');\n    const newcourseurl = root.find(SELECTORS.courseView.region).attr('data-newcourseurl');\n    return Templates.render(TEMPLATES.NOCOURSES, {\n        nocoursesimg: nocoursesimg,\n        newcourseurl: newcourseurl\n    });\n};\n\n/**\n * Render the dashboard courses.\n *\n * @param {object} root The root element for the courses view.\n * @param {array} coursesData containing array of returned courses.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCourses = (root, coursesData) => {\n\n    const filters = getFilterValues(root);\n\n    let currentTemplate = '';\n    if (filters.display === 'card') {\n        currentTemplate = TEMPLATES.COURSES_CARDS;\n    } else if (filters.display === 'list') {\n        currentTemplate = TEMPLATES.COURSES_LIST;\n    } else {\n        currentTemplate = TEMPLATES.COURSES_SUMMARY;\n    }\n\n    if (!coursesData) {\n        return noCoursesRender(root);\n    } else {\n        // Sometimes we get weird objects coming after a failed search, cast to ensure typing functions.\n        if (Array.isArray(coursesData.courses) === false) {\n            coursesData.courses = Object.values(coursesData.courses);\n        }\n        // Whether the course category should be displayed in the course item.\n        coursesData.courses = coursesData.courses.map(course => {\n            course.showcoursecategory = filters.displaycategories === 'on';\n            return course;\n        });\n        if (coursesData.courses.length) {\n            return Templates.render(currentTemplate, {\n                courses: coursesData.courses,\n            });\n        } else {\n            return noCoursesRender(root);\n        }\n    }\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownContainer The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} categoriesData containing array of returned categories.\n * @param {array} selectionsData containing array of selected categories.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCategories = (dropdownContainer, dropdown, categoriesData, selectionsData, page) => {\n\n    // const filters = getFilterValues(categories);\n\n    const template = 'block_eledia_telc_coursesearch/nav-category-dropdown';\n\n    // NOTE: Render function for mustache.\n    window.console.log('render categoriesData');\n    return Templates.renderForPromise(template, {\n        categories: categoriesData,\n        catselections: selectionsData,\n    }).then(({ html, js }) => {\n        window.console.log('replaceNodeContents');\n        window.console.log(html);\n        window.console.log(js);\n        const renderResult = Templates.replaceNodeContents(dropdownContainer, html, js);\n        const catDropdowns = page.querySelectorAll(dropdown);\n        catDropdowns.forEach(cdd => { cdd.style.display = 'block'; });\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownContainer The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} tagsData containing array of returned categories.\n * @param {array} selectionsData containing array of selected categories.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderTags = (dropdownContainer, dropdown, tagsData, selectionsData, page) => {\n\n    const template = 'block_eledia_telc_coursesearch/nav-tags-dropdown';\n\n    // NOTE: Render function for mustache.\n    return Templates.renderForPromise(template, {\n        tags: tagsData,\n        tagsselections: selectionsData,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownContainer, html, js);\n        const catDropdowns = page.querySelectorAll(dropdown);\n        catDropdowns.forEach(cdd => { cdd.style.display = 'block'; });\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownDiv The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} customfieldsData containing array of returned categories.\n * @param {array} selectionsData containing array of selected categories.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCustomfields = (dropdownDiv, dropdown, customfieldsData, selectionsData, page) => { // eslint-disable-line\n\n    const template = 'block_eledia_telc_coursesearch/nav-customfield-dropdown';\n    const dropdownObject = document.querySelector(dropdownDiv);\n    window.console.log('dropdownDiv:', dropdownDiv);\n    window.console.log('dropdownObject:', dropdownObject);\n    // NOTE: Render function for mustache.\n    return Templates.renderForPromise(template, {\n        customvalues: customfieldsData,\n        customselections: selectionsData,\n        customfieldid: currentCustomField,\n        description: dropdownObject.dataset.description,\n    }).then(({ html, js }) => {\n        window.console.log('dropdownDiv');\n        window.console.log(dropdownDiv);\n        const renderResult = Templates.replaceNodeContents(dropdownDiv, html, js);\n        window.console.log('renderResult');\n        window.console.log(renderResult);\n        const cuDropdowns = page.querySelectorAll(dropdown);\n        // const cuDropdown = page.querySelector(dropdown);\n        window.console.log(dropdown);\n        window.console.log(cuDropdowns);\n        cuDropdowns.forEach(cuDropdown => { cuDropdown.style.display = 'block'; });\n        // cuDropdown.style.display = 'block';\n        window.console.log('renderCustomfields wnd');\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Return the callback to be passed to the subscribe event\n *\n * @param {object} root The root element for the courses view\n * @return {function} Partially applied function that'll execute when passed a limit\n */\nconst setLimit = root => {\n    // @param {Number} limit The paged limit that is passed through the event.\n    return limit => root.find(SELECTORS.courseView.region).attr('data-paging', limit);\n};\n\n/**\n * Intialise the paged list and cards views on page load.\n * Returns an array of paged contents that we would like to handle here\n *\n * @param {object} root The root element for the courses view\n * @param {string} namespace The namespace for all the events attached\n */\nconst registerPagedEventHandlers = (root, namespace) => {\n    const event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n    PubSub.subscribe(event, setLimit(root));\n};\n\n/**\n * Figure out how many items are going to be allowed to be rendered in the block.\n *\n * @param  {Number} pagingLimit How many courses to display\n * @param  {Object} root The course overview container\n * @return {Number[]} How many courses will be rendered\n */\nconst itemsPerPageFunc = (pagingLimit, root) => {\n    let itemsPerPage = NUMCOURSES_PERPAGE.map(value => {\n        let active = false;\n        if (value === pagingLimit) {\n            active = true;\n        }\n\n        return {\n            value: value,\n            active: active\n        };\n    });\n\n    // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n    const totalCourseCount = parseInt(root.find(SELECTORS.courseView.region).attr('data-totalcoursecount'), 10);\n    return itemsPerPage.filter(pagingOption => {\n        if (pagingOption.value === 0 && totalCourseCount > 100) {\n            // To minimise performance issues, do not show the \"All\" option\n            // if the user is enrolled in more than 100 courses.\n            return false;\n        }\n        return pagingOption.value < totalCourseCount;\n    });\n};\n\n/**\n * Mutates and controls the loadedPages array and handles the bootstrapping.\n *\n * @param {Array|Object} coursesData Array of all of the courses to start building the page from\n * @param {Number} currentPage What page are we currently on?\n * @param {Object} pageData Any current page information\n * @param {Object} actions Paged content helper\n * @param {null|boolean} activeSearch Are we currently actively searching and building up search results?\n */\nconst pageBuilder = (coursesData, currentPage, pageData, actions, activeSearch = null) => {\n    // If the courseData comes in an object then get the value otherwise it is a pure array.\n    let courses = coursesData.courses ? coursesData.courses : coursesData;\n    let nextPageStart = 0;\n    let pageCourses = [];\n\n    // If current page's data is loaded make sure we max it to page limit.\n    if (typeof (loadedPages[currentPage]) !== 'undefined') {\n        pageCourses = loadedPages[currentPage].courses;\n        const currentPageLength = pageCourses.length;\n        if (currentPageLength < pageData.limit) {\n            nextPageStart = pageData.limit - currentPageLength;\n            pageCourses = { ...loadedPages[currentPage].courses, ...courses.slice(0, nextPageStart) };\n        }\n    } else {\n        // When the page limit is zero, there is only one page of courses, no start for next page.\n        nextPageStart = pageData.limit || false;\n        pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n    }\n\n    // Finished setting up the current page.\n    loadedPages[currentPage] = {\n        courses: pageCourses\n    };\n\n    // Set up the next page (if there is more than one page).\n    const remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n    if (remainingCourses.length) {\n        loadedPages[currentPage + 1] = {\n            courses: remainingCourses\n        };\n    }\n\n    // Set the last page to either the current or next page.\n    if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n        lastPage = currentPage;\n        if (activeSearch === null) {\n            actions.allItemsLoaded(currentPage);\n        }\n    } else if (typeof (loadedPages[currentPage + 1]) !== 'undefined'\n        && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n        lastPage = currentPage + 1;\n    }\n\n    courseOffset = coursesData.nextoffset;\n};\n\n/**\n * In cases when switching between regular rendering and search rendering we need to reset some variables.\n */\nconst resetGlobals = () => {\n    courseOffset = 0;\n    loadedPages = [];\n    lastPage = 0;\n    lastLimit = 0;\n};\n\n/**\n * The default functionality of fetching paginated courses without special handling.\n *\n * @return {function(Object, Object, Object, Object, Object, Promise, Number, Object): void}\n */\nconst standardFunctionalityCurry = () => {\n    resetGlobals();\n    return (filters, currentPage, pageData, actions, root, promises, limit, searchParams) => {\n        const pagePromise = getMyCourses(\n            filters,\n            limit,\n            searchParams\n        ).then(coursesData => {\n            pageBuilder(coursesData, currentPage, pageData, actions);\n            return renderCourses(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        promises.push(pagePromise);\n    };\n};\n\n/**\n * Initialize the searching functionality so we can call it when required.\n *\n * @return {function(Object, Number, Object, Object, Object, Promise, Number, String): void}\n */\nconst searchFunctionalityCurry = () => {\n    resetGlobals();\n    return (filters, currentPage, pageData, actions, root, promises, limit, inputValue) => {\n        const searchingPromise = getSearchMyCourses(\n            filters,\n            limit,\n            inputValue\n        ).then(coursesData => {\n            const searchTerm = document.querySelector('.block-eledia_telc_coursesearch [data-action=\"search\"]').value;\n            window.console.log('searchTerm');\n            window.console.log(searchTerm);\n            if (searchTerm.trim() !== '') {\n                window.console.log('coursesData');\n                window.console.log(coursesData);\n                coursesData.courses.forEach(c => {\n                    const word = searchTerm.trim();\n                    const summary = c.summary;\n                    const fullname = c.fullname;\n                    const escapedWord = word.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n                    const regex = new RegExp(`(${escapedWord})`, 'gi');\n                    c.summary = summary.replace(regex, '<mark>$1</mark>');\n                    c.fullname = fullname.replace(regex, '<mark>$1</mark>');\n                });\n            }\n\n            pageBuilder(coursesData, currentPage, pageData, actions);\n            return renderCourses(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        promises.push(searchingPromise);\n    };\n};\n\n/**\n * Initialize the categoy searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst catSearchFunctionality = () => {\n    return (dropdownContainer, dropdown, dropdownHelper, page, selectedCategories) => {\n        const searchingPromise = getSearchCategories().then(categoriesData => {\n            // NOTE: Here it goes.\n            selectableCategories = categoriesData;\n            selectedCategories.forEach((selected) => {\n                const categoryIndex = selectableCategories.findIndex(item => item.id == selected.id);\n                if (categoryIndex !== -1) {\n                    selectableCategories.splice(categoryIndex, 1);\n                }\n            });\n            //return renderCategories(dropdownContainer, dropdown, categoriesData, page);\n            const dropdowns = dropdownHelper('categories', dropdownContainer, true);\n            return dropdowns.forEach(ddc => {\n                return renderCategories(ddc, dropdown, selectableCategories, selectedCategories, page);\n            });\n            //pageBuilder(categoriesData, actions);\n            //return renderCategories(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        // promises.push(searchingPromise);\n        // window.console.log(searchingPromise);\n        return searchingPromise;\n    };\n};\n\n/**\n * Initialize the tags searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst tagsSearchFunctionality = () => {\n    return (dropdownContainer, dropdown, dropdownHelper, page, selectedTags) => {\n        const searchingPromise = getSearchTags().then(tagsData => {\n            // NOTE: Here it goes.\n            selectableTags = tagsData;\n            selectedTags.forEach((selected) => {\n                const tagsIndex = selectableTags.findIndex(item => item.id == selected.id);\n                if (tagsIndex !== -1) {\n                    selectableTags.splice(tagsIndex, 1);\n                }\n            });\n            //return renderCategories(dropdownContainer, dropdown, categoriesData, page);\n            const dropdowns = dropdownHelper('tags', dropdownContainer, true);\n            return dropdowns.forEach(ddc => {\n                return renderTags(ddc, dropdown, selectableTags, selectedTags, page);\n            });\n            //pageBuilder(categoriesData, actions);\n            //return renderCategories(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        // promises.push(searchingPromise);\n        // window.console.log(searchingPromise);\n        return searchingPromise;\n    };\n};\n\n/**\n * Initialize the custom field searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst customfieldSearchFunctionality = () => {\n    return (dropdownDiv, dropdown, dropdownHelper, page, searchterm) => {\n        const searchingPromise = getSearchCustomfields().then(customfieldsData => {\n            const noneOptionIndex = customfieldsData.findIndex(option => option.value === -1);\n            // TODO: Fields may have different methods of signaling 'select none' options. -1 might be a legit value.\n            if (noneOptionIndex !== -1) {\n                customfieldsData.splice(noneOptionIndex, 1);\n            }\n            customfields[currentCustomField] = customfieldsData;\n            if (selectedCustomfields[currentCustomField] === undefined) {\n                selectedCustomfields[currentCustomField] = [];\n            }\n            selectedCustomfields[currentCustomField]?.forEach((selected) => {\n                const customfieldIndex = customfields[currentCustomField].findIndex(item => item.value === selected.value);\n                if (customfieldIndex !== -1) {\n                    customfields[currentCustomField].splice(customfieldIndex, 1);\n                }\n            });\n            filteredCustomfields[currentCustomField] = customfields[currentCustomField];\n            if (searchterm && searchterm.trim() !== '') {\n                filteredCustomfields[currentCustomField] = filteredCustomfields[currentCustomField].filter(\n                    item => item.name.toLowerCase().includes(searchterm.trim().toLowerCase()));\n            }\n            const dropdowns = dropdownHelper('customfields', dropdownDiv, true);\n            return dropdowns.forEach(ddiv => {\n\n                return renderCustomfields(ddiv,\n                    dropdown,\n                    filteredCustomfields[currentCustomField],\n                    selectedCustomfields[currentCustomField],\n                    page);\n            });\n        }).catch(Notification.exception);\n\n        return searchingPromise;\n    };\n};\n\n/**\n * Initialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n * @param {function} promiseFunction How do we fetch the courses and what do we do with them?\n * @param {null | string} inputValue What to search for\n * @param {object} params The params\n */\nconst initializePagedContent = (root, promiseFunction, inputValue = null, params) => {// eslint-disable-line\n    const pagingLimit = parseInt(root.find(SELECTORS.courseView.region).attr('data-paging'), 10);\n    let itemsPerPage = itemsPerPageFunc(pagingLimit, root);\n\n    const config = { ...{}, ...DEFAULT_PAGED_CONTENT_CONFIG };\n    config.eventNamespace = namespace;\n\n    const pagedContentPromise = PagedContentFactory.createWithLimit(\n        itemsPerPage,\n        (pagesData, actions) => {\n            let promises = [];\n            pagesData.forEach(pageData => {\n                const currentPage = pageData.pageNumber;\n                let limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                // Reset local variables if limits have changed.\n                if (+lastLimit !== +limit) {\n                    loadedPages = [];\n                    courseOffset = 0;\n                    lastPage = 0;\n                }\n\n                if (lastPage === currentPage) {\n                    // If we are on the last page and have it's data then load it from cache.\n                    actions.allItemsLoaded(lastPage);\n                    promises.push(renderCourses(root, loadedPages[currentPage]));\n                    return;\n                }\n\n                lastLimit = limit;\n\n                // Get 2 pages worth of data as we will need it for the hidden functionality.\n                if (typeof (loadedPages[currentPage + 1]) === 'undefined') {\n                    if (typeof (loadedPages[currentPage]) === 'undefined') {\n                        limit *= 2;\n                    }\n                }\n\n                // Get the current applied filters.\n                const filters = getFilterValues(root);\n\n                // TODO: exchange with original function.\n                window.console.log(getAllFilterValues(root));\n\n                // Call the curried function that'll handle the course promise and any manipulation of it.\n                promiseFunction(filters, currentPage, pageData, actions, root, promises, limit, params);\n            });\n            return promises;\n        },\n        config\n    );\n\n    pagedContentPromise.then((html, js) => {\n        registerPagedEventHandlers(root, namespace);\n        window.console.log('html');\n        window.console.log(html);\n        return Templates.replaceNodeContents(root.find(SELECTORS.courseView.region), html, js);\n    }).catch(Notification.exception);\n};\n\n/**\n * Initialise the list of categories in the search dropdown.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {function} dropdownHelper\n * @param {object} page The page object.\n * @param {object} selectedCategories\n */\nconst initializeCategorySearchContent = (dropdownContainer,\n    dropdown,\n    promiseFunction,\n    dropdownHelper,\n    page,\n    selectedCategories) => {// eslint-disable-line\n    const categories = promiseFunction(dropdownContainer,\n        dropdown,\n        dropdownHelper,\n        page,\n        selectedCategories);\n    window.console.log(categories);\n};\n\n/**\n * Initialise the list of tags in the search dropdown.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {function} dropdownHelper\n * @param {object} page The page object.\n * @param {object} selectedTags\n */\nconst initializeTagsSearchContent = (dropdownContainer,\n    dropdown,\n    promiseFunction,\n    dropdownHelper,\n    page,\n    selectedTags) => {// eslint-disable-line\n    const categories = promiseFunction(dropdownContainer,\n        dropdown,\n        dropdownHelper,\n        page,\n        selectedTags);\n    window.console.log(categories);\n};\n\n/**\n * Initialise the list of categories in the search dropdown.\n * TODO: Implement.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {object} dropdownHelper\n * @param {object} page The page object.\n * @param {string} searchterm The current searchterm.\n */\nconst initializeCustomfieldSearchContent = (dropdownContainer,\n    dropdown,\n    promiseFunction,\n    dropdownHelper,\n    page,\n    searchterm) => {// eslint-disable-line\n    const $customfields = promiseFunction(dropdownContainer,\n        dropdown,\n        dropdownHelper,\n        page,\n        searchterm);\n    window.console.log($customfields);\n};\n\n/**\n * Listen to, and handle events for the eledia_telc_coursesearch block.\n *\n * @param {Object} root The eledia_telc_coursesearch block container element.\n * @param {HTMLElement} page The whole HTMLElement for our block.\n */\nconst registerEventListeners = (root, page) => {\n\n    CustomEvents.define(root, [\n        CustomEvents.events.activate\n    ]);\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, (e, data) => {\n        const favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n        const courseId = getCourseId(favourite);\n        addToFavourites(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, (e, data) => {\n        const favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n        const courseId = getCourseId(favourite);\n        removeFromFavourites(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, (e, data) => {\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, (e, data) => {\n        const target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n        const courseId = getCourseId(target);\n        hideCourse(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, (e, data) => {\n        const target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n        const courseId = getCourseId(target);\n        showCourse(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    // Searching functionality event handlers.\n    const input = page.querySelector(SELECTORS.region.searchInput);\n    const clearIcons = page.querySelectorAll(SELECTORS.region.clearIcon);\n    const catinputs = page.querySelectorAll(SELECTORS.cat.input);\n    const tagsinputs = page.querySelectorAll(SELECTORS.tags.input);\n    const customInputs = page.querySelectorAll(SELECTORS.customfields.input);\n    const clearCatIcons = page.querySelectorAll(SELECTORS.cat.clearIcon);\n    const clearTagsIcons = page.querySelectorAll(SELECTORS.tags.clearIcon);\n    const clearCustomfieldIcons = page.querySelectorAll(SELECTORS.customfields.clearIcon);\n    const customClass = SELECTORS.customfields.searchfield;\n    const catSelectable = SELECTORS.cat.selectableItem;\n    const catSelected = SELECTORS.cat.selectedItem;\n    const tagsSelectable = SELECTORS.tags.selectableItem;\n    const tagsSelected = SELECTORS.tags.selectedItem;\n    const customfieldSelectable = SELECTORS.customfields.selectableItem;\n    const customfieldSelected = SELECTORS.customfields.selectedItem;\n    const groupingFilter = page.querySelectorAll(SELECTORS.FILTER_GROUPING);\n\n    clearIcons.forEach(icon => {\n        icon.addEventListener('click', () => {\n            input.value = '';\n            searchTerm = '';\n            input.focus();\n            clearIcons.forEach(ci => {\n                clearSearch(ci, root);\n            });\n        });\n    });\n\n    clearCatIcons.forEach(icon => {\n        icon.addEventListener('click', () => {\n            window.console.log('CLICKED clearCatIcon');\n            catSearchTerm = '';\n            catinputs.forEach(input => {\n                input.value = '';\n            });\n            catinput().focus();\n            clearCatIcons.forEach(i => {\n                clearCatSearch(i);\n            });\n            initializeCategorySearchContent(\n                SELECTORS.cat.dropdownDiv,\n                SELECTORS.cat.dropdown,\n                catSearchFunctionality(),\n                dropdownHelper,\n                page,\n                selectedCategories);\n        });\n    });\n\n    clearTagsIcons.forEach(icon => {\n        icon.addEventListener('click', () => {\n            window.console.log('CLICKED clearCatIcon');\n            tagsSearchTerm = '';\n            tagsinputs.forEach(input => {\n                input.value = '';\n            });\n            tagsinput().focus();\n            clearTagsIcons.forEach(i => {\n                clearCatSearch(i);\n            });\n            initializeTagsSearchContent(\n                SELECTORS.tags.dropdownDiv,\n                SELECTORS.tags.dropdown,\n                tagsSearchFunctionality(),\n                dropdownHelper,\n                page,\n                selectedTags);\n        });\n    });\n\n    clearCustomfieldIcons.forEach(icon => {\n        currentCustomField = icon.dataset.customfieldid;\n        const customfieldInputs = page.querySelectorAll(customClass + currentCustomField);\n        icon.addEventListener('click', () => {\n            window.console.log('CLICKED clearCustomfieldIcon');\n            customfieldInputs.forEach(input => {\n                input.value = '';\n            });\n            customfieldInput(customClass + currentCustomField).focus();\n            clearCustomfieldSingleIconSearch(icon);\n            initializeCustomfieldSearchContent(\n                SELECTORS.customfields.dropdownDiv + currentCustomField,\n                SELECTORS.customfields.dropdown + currentCustomField,\n                customfieldSearchFunctionality(),\n                dropdownHelper,\n                page,\n                '');\n        });\n    });\n\n    input.addEventListener('input', debounce(() => {\n        if (input.value === '') {\n            searchTerm = '';\n            clearIcons.forEach(icon => {\n                clearSearch(icon, root);\n            });\n        } else {\n            clearIcons.forEach(icon => {\n                activeSearch(icon);\n            });\n            searchTerm = input.value.trim();\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    }, 1000));\n\n    // Flow:\n    // eventListener\n    // initializeCustomfieldSearchContent()\n    // customfieldSearchFunctionality()\n    // renderCustomfields()\n    customInputs.forEach(i => {\n        i.addEventListener('click', (e) => {\n            currentCustomField = e.target.dataset.customfieldid;\n            handleCustomfieldSwitch(currentCustomField);\n            const currentSearchterm = e.target.value.toLowerCase();\n            initializeCustomfieldSearchContent(\n                SELECTORS.customfields.dropdownDiv + currentCustomField,\n                SELECTORS.customfields.dropdown + currentCustomField,\n                customfieldSearchFunctionality(),\n                dropdownHelper,\n                page,\n                currentSearchterm);\n        });\n        i.addEventListener('input', debounce((e) => {\n            currentCustomField = e.target.dataset.customfieldid;\n            const currentSearchterm = e.target.value.toLowerCase();\n            if (currentSearchterm === '') {\n                clearCustomfieldSearch(clearCustomfieldIcons);\n                manageCustomfielddropdownItems(\n                    e,\n                    customfieldSelected,\n                    customfieldSelectable,\n                    SELECTORS.customfields.dropdownDiv + currentCustomField,\n                    SELECTORS.customfields.dropdown + currentCustomField,\n                    dropdownHelper,\n                    page);\n            } else {\n                filteredCustomfields[currentCustomField] = filteredCustomfields[currentCustomField].filter(\n                    item => item.name.toLowerCase().includes(currentSearchterm.toLowerCase().trim()));\n                activeCustomfieldSearch(clearCustomfieldIcons);\n                manageCustomfielddropdownItems(\n                    e,\n                    customfieldSelected,\n                    customfieldSelectable,\n                    SELECTORS.customfields.dropdownDiv + currentCustomField,\n                    SELECTORS.customfields.dropdown + currentCustomField,\n                    dropdownHelper,\n                    page);\n            }\n        }, 1000));\n    });\n\n    // Initialize category search dropdown on first click.\n    catinputs.forEach(ci => {\n        ci.addEventListener('click', () => {\n            initializeCategorySearchContent(\n                SELECTORS.cat.dropdownDiv,\n                SELECTORS.cat.dropdown,\n                catSearchFunctionality(),\n                dropdownHelper,\n                page,\n                selectedCategories);\n        });\n    });\n\n    catinputs.forEach(catinput => {\n        catinput.addEventListener('input', debounce(() => {\n            if (catinput.value === '') {\n                clearCatIcons.forEach(icon => {\n                    clearCatSearch(icon);\n                });\n                copyCatValues('');\n                catSearchTerm = '';\n                initializeCategorySearchContent(\n                    SELECTORS.cat.dropdownDiv,\n                    SELECTORS.cat.dropdown,\n                    catSearchFunctionality(),\n                    dropdownHelper,\n                    page,\n                    selectedCategories);\n            } else {\n                window.console.log('catinput.value');\n                window.console.log(catinput.value);\n                clearCatIcons.forEach(icon => {\n                    activeSearch(icon);\n                });\n                catSearchTerm = catinput.value.trim();\n                copyCatValues(catinput.value);\n                initializeCategorySearchContent(\n                    SELECTORS.cat.dropdownDiv,\n                    SELECTORS.cat.dropdown,\n                    catSearchFunctionality(),\n                    dropdownHelper,\n                    page,\n                    selectedCategories);\n            }\n        }, 1000));\n    });\n\n    /**\n     * Copies the given value to all category input fields.\n     *\n     * @param {string} value The value to set for all category input fields.\n     */\n    function copyCatValues(value) {\n        catinputs.forEach(ci => {\n            ci.value = value;\n        });\n    }\n\n    // Initialize tags search dropdown on first click.\n    tagsinputs.forEach(tagsinput => {\n        tagsinput.addEventListener('click', () => {\n            initializeTagsSearchContent(\n                SELECTORS.tags.dropdownDiv,\n                SELECTORS.tags.dropdown,\n                tagsSearchFunctionality(),\n                dropdownHelper,\n                page,\n                selectedTags);\n        });\n    });\n\n    tagsinputs.forEach(tagsinput => {\n        tagsinput.addEventListener('input', debounce(() => {\n            if (tagsinput.value === '') {\n                clearTagsIcons.forEach(icon => {\n                    clearCatSearch(icon);\n                });\n                tagsSearchTerm = '';\n                copyTagsValues('');\n                initializeTagsSearchContent(\n                    SELECTORS.tags.dropdownDiv,\n                    SELECTORS.tags.dropdown,\n                    tagsSearchFunctionality(),\n                    dropdownHelper,\n                    page,\n                    selectedTags);\n            } else {\n                clearTagsIcons.forEach(icon => {\n                    activeSearch(icon);\n                });\n                tagsSearchTerm = tagsinput.value.trim();\n                copyTagsValues(tagsinput.value);\n                initializeTagsSearchContent(\n                    SELECTORS.tags.dropdownDiv,\n                    SELECTORS.tags.dropdown,\n                    tagsSearchFunctionality(),\n                    dropdownHelper,\n                    page,\n                    selectedTags);\n            }\n        }, 1000));\n    });\n\n\n\n    /**\n     * Copies the given value to all tags input fields.\n     *\n     * @param {string} value The value to set for all tags input fields.\n     */\n    function copyTagsValues(value) {\n        tagsinputs.forEach(ti => {\n            ti.value = value;\n        });\n    }\n\n\n    document.body.addEventListener('click', manageCategorydropdownCollapse);\n    document.body.addEventListener('click', manageTagsdropdownCollapse);\n    document.body.addEventListener('click', manageCustomfielddropdownCollapse);\n\n    document.body.addEventListener('click', (e) => {\n        if (e.target.classList.contains(catSelected) || e.target.classList.contains(catSelectable)) {\n            e.preventDefault();\n            manageCategorydropdownItems(\n                e,\n                catSelected,\n                catSelectable,\n                SELECTORS.cat.dropdownDiv,\n                SELECTORS.cat.dropdown,\n                dropdownHelper,\n                page);\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        if (e.target.classList.contains(tagsSelected) || e.target.classList.contains(tagsSelectable)) {\n            e.preventDefault();\n            manageTagsdropdownItems(\n                e,\n                tagsSelected,\n                tagsSelectable,\n                SELECTORS.tags.dropdownDiv,\n                SELECTORS.tags.dropdown,\n                dropdownHelper,\n                page);\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        if (e.target.classList.contains(customfieldSelected) || e.target.classList.contains(customfieldSelectable)) {\n            e.preventDefault();\n            const currentId = e.target.dataset.customfieldid;\n            manageCustomfielddropdownItems(\n                e,\n                customfieldSelected,\n                customfieldSelectable,\n                SELECTORS.customfields.dropdownDiv + currentId,\n                SELECTORS.customfields.dropdown + currentId,\n                dropdownHelper,\n                page);\n            // TODO: Initialize search on *every* change.\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        const expandLink = e.target;\n        if (expandLink.classList.contains('eledia-telc-expandsummary')) {\n            e.preventDefault();\n            const summary = e.target.previousElementSibling;\n            expandLink.classList.add('d-none');\n            summary.classList.remove('summary-fadeout');\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        const collapseLink = e.target;\n        if (collapseLink.classList.contains('eledia-telc-collapsesummary')) {\n            e.preventDefault();\n            const summary = e.target.parentElement;\n            const expandLink = summary.nextElementSibling;\n            expandLink.classList.remove('d-none');\n            summary.classList.add('summary-fadeout');\n        }\n    });\n\n    groupingFilter.forEach(filter => {\n        const filterType = filter.dataset.value;\n        filter.addEventListener('click', () => {\n            courseInProgress = filterType;\n        });\n    });\n\n};\n/*\n * @param {string} dataSource\n * @param {string} selector\n * @param {boolean} all\n */\nconst dropdownHelper = (dataSource, selector, all = false) => {\n\n    let data;\n    let parts;\n    let index;\n    let reverseState;\n    const collapse = '[data-region=\"filter\"][role=\"search\"] > .row > .customfields-collapse > .collapse-filter ';\n    const noCollapse = '[data-region=\"filter\"][role=\"search\"] > .row > .collapse-filter ';\n    switch (dataSource) {\n        case 'categories':\n            reverseState = catReverseState;\n            data = selectedCategories;\n            break;\n        case 'tags':\n            reverseState = tagsReverseState;\n            data = selectedTags;\n            break;\n        case 'customfields':\n            if (all) {\n                break;\n            }\n            if (document.querySelectorAll(selector).length === 1) {\n                return selector;\n            }\n            reverseState = customReverseState;\n            parts = selector.split('-');\n            index = parseInt(parts[parts.length - 1]);\n            data = selectedCustomfields[index] || [];\n            break;\n        default:\n            throw new Error('Invalid data source \"' + dataSource + '\" for dropdownHelper');\n    }\n    if (all) {\n        if (document.querySelectorAll(selector).length === 1) {\n            return [selector, selector];\n        }\n        return [collapse + selector, noCollapse + selector];\n    }\n    if (document.querySelectorAll(selector).length === 1) {\n        return selector;\n    }\n    if (data.length === 0) {\n        return reverseState ? noCollapse + selector : collapse + selector;\n    }\n    return reverseState ? collapse + selector : noCollapse + selector;\n};\n\n/**\n * Eventlistener helper to return the correct catinput element.\n *\n */\nexport const catinput = () => {\n    const catinputs = document.querySelectorAll(SELECTORS.cat.input);\n    return selectedCategories.length === 0 && !catReverseState ? catinputs[1] : catinputs[0];\n};\n\n/**\n * Eventlistener helper to return the correct tagsinput element.\n *\n */\nexport const tagsinput = () => {\n    const tagsinputs = document.querySelectorAll(SELECTORS.tags.input);\n    return selectedTags.length === 0 ? tagsinputs[1] : tagsinputs[0];\n};\n\n/**\n * Eventlistener helper to return the correct customfield input element.\n * @param {String} customfieldClass\n */\nexport const customfieldInput = (customfieldClass) => {\n    if (document.querySelectorAll(customfieldClass).length === 1) {\n        const customfieldInput = document.querySelector(customfieldClass);\n        return customfieldInput;\n    }\n    const customfieldInputs = document.querySelectorAll(customfieldClass);\n    return selectedCustomfields[currentCustomField].length === 0 ? customfieldInputs[1] : customfieldInputs[0];\n};\n\n/**\n * Reset the search icon and trigger the init for the block.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n * @param {Object} root The eledia_telc_coursesearch block container element.\n */\nexport const clearSearch = (clearIcon, root) => {\n    clearIcon.classList.add('d-none');\n    init(root);\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} clearCatIcon Our closing icon to manipulate.\n */\nexport const clearCatSearch = (clearCatIcon) => {\n    clearCatIcon.classList.add('d-none');\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} clearCustomfieldIcons Our closing icon to manipulate.\n */\nexport const clearCustomfieldSearch = (clearCustomfieldIcons) => {\n    clearCustomfieldIcons.forEach(icon => {\n        if (icon.dataset.customfieldid === currentCustomField) {\n            icon.classList.add('d-none');\n        }\n    });\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} icon Our closing icon to manipulate.\n */\nexport const clearCustomfieldSingleIconSearch = icon => { icon.classList.add('d-none'); };\n\n/**\n * Change the searching icon to its' active state. *\n *\n * @param {HTMLElement} clearCustomfieldIcons Our closing icon to manipulate.\n */\nexport const activeCustomfieldSearch = (clearCustomfieldIcons) => {\n    clearCustomfieldIcons.forEach(icon => {\n        if (icon.dataset.customfieldid === currentCustomField) {\n            icon.classList.remove('d-none');\n        }\n    });\n};\n\n/**\n * Change the searching icon to its' active state.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n */\nconst activeSearch = (clearIcon) => {\n    clearIcon.classList.remove('d-none');\n};\n\n/**\n * Hide category dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n */\nconst manageCategorydropdownCollapse = (e) => {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n\n    const catDropdowns = page.querySelectorAll(SELECTORS.cat.dropdown);\n    const catInputs = page.querySelectorAll(SELECTORS.cat.input);\n\n    // We don't want to close the dropdown if clicking inside it or the input field.\n    for (const dropdown of catDropdowns) {\n        if (dropdown.contains(e.target)) {\n            return;\n        }\n    }\n    for (const input of catInputs) {\n        if (input.contains(e.target)) {\n            return;\n        }\n    }\n    catReverseState = false;\n\n    if (e.target.classList.contains('catprevent') && !e.target.classList.contains('fa-xmark')) {\n        catDropdowns.forEach(dropdown => {\n            dropdown.style.display = 'block';\n        });\n        return;\n    }\n\n    catDropdowns.forEach(dropdown => {\n        dropdown.style.display = 'none';\n    });\n    const catSelectElements = document.querySelectorAll('.collapse-filter-category');\n    if (selectedCategories.length === 0) {\n        catSelectElements.forEach(e => {\n            if (!e.classList.contains('collapse-enabled')) {\n                e.classList.add('collapse-enabled');\n            }\n        });\n        return;\n    }\n    catSelectElements.forEach(e => {\n        if (e.classList.contains('collapse-enabled')) {\n            e.classList.remove('collapse-enabled');\n        }\n    });\n\n};\n\n/**\n * Hide tags dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n */\nconst manageTagsdropdownCollapse = (e) => {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const tagsDropdowns = page.querySelectorAll(SELECTORS.tags.dropdown);\n    const tagsInputs = page.querySelectorAll(SELECTORS.tags.input);\n    // if (!e.target.classList.contains('tagsprevent') && !e.target.classList.contains('fa-xmark')) {\n    //     tagsDropdown.style.display = 'none';\n    // } else if (e.target.classList.contains('tagsprevent') && !e.target.classList.contains('fa-xmark')) {\n    //     tagsDropdown.style.display = 'block';\n    // }\n\n    for (const dropdown of tagsDropdowns) {\n        if (dropdown.contains(e.target)) {\n            return;\n        }\n    }\n    for (const input of tagsInputs) {\n        if (input.contains(e.target)) {\n            return;\n        }\n    }\n    tagsReverseState = false;\n\n    if (e.target.classList.contains('tagsprevent') && !e.target.classList.contains('fa-xmark')) {\n        tagsDropdowns.forEach(dropdown => {\n            dropdown.style.display = 'block';\n        });\n        return;\n    }\n\n    tagsDropdowns.forEach(dropdown => {\n        dropdown.style.display = 'none';\n    });\n    const tagsSelectElements = document.querySelectorAll('.collapse-filter-tags');\n    if (selectedTags.length === 0) {\n        tagsSelectElements.forEach(e => {\n            if (!e.classList.contains('collapse-enabled')) {\n                e.classList.add('collapse-enabled');\n            }\n        });\n        return;\n    }\n    tagsSelectElements.forEach(e => {\n        if (e.classList.contains('collapse-enabled')) {\n            e.classList.remove('collapse-enabled');\n        }\n    });\n};\n\n/**\n * TODO: complete\n * Hide category dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n * @param {string} selected\n * @param {string} selectable\n * @param {string} dropdownDiv\n * @param {string} dropdown\n * @param {object} dropdownHelper\n * @param {object} page\n **/\nconst manageCategorydropdownItems = (e, selected, selectable, dropdownDiv, dropdown, dropdownHelper, page) => {// eslint-disable-line\n    const template = 'block_eledia_telc_coursesearch/nav-category-dropdown';\n    const categoryId = e.target.dataset.catId;\n    dropdownDiv = dropdownHelper('categories', dropdownDiv);\n    dropdown = dropdownHelper('categories', dropdown);\n    const selectedLength = selectedCategories.length;\n    if (e.target.classList.contains(selectable)) {\n        const categoryIndex = selectableCategories.findIndex(value => value.id == categoryId);\n        selectedCategories.push(selectableCategories.splice(categoryIndex, 1)[0]);\n        if ((!selectedLength && selectedCategories.length > 0)) {\n            window.console.log('cat reversed1');\n            catReverseState = !catReverseState;\n        }\n    } else {\n        const categoryIndex = selectedCategories.findIndex(value => value.id == categoryId);\n        selectableCategories.push(selectedCategories.splice(categoryIndex, 1)[0]);\n        if ((selectedLength && selectedCategories.length === 0)) {\n            window.console.log('cat reversed2');\n            catReverseState = !catReverseState;\n        }\n    }\n    return Templates.renderForPromise(template, {\n        categories: selectableCategories,\n        catselections: selectedCategories,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownDiv, html, js);\n        const catDropdown = page.querySelector(dropdown);\n        catDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Hide tags dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n * @param {string} selected\n * @param {string} selectable\n * @param {string} dropdownDiv\n * @param {string} dropdown\n * @param {object} dropdownHelper\n * @param {object} page\n **/\nconst manageTagsdropdownItems = (e, selected, selectable, dropdownDiv, dropdown, dropdownHelper, page) => {// eslint-disable-line\n    const template = 'block_eledia_telc_coursesearch/nav-tags-dropdown';\n    const tagsId = e.target.dataset.tagsId;\n    dropdownDiv = dropdownHelper('tags', dropdownDiv);\n    dropdown = dropdownHelper('tags', dropdown);\n    const selectedLength = selectedTags.length;\n    if (e.target.classList.contains(selectable)) {\n        const tagsIndex = selectableTags.findIndex(value => value.id == tagsId);\n        selectedTags.push(selectableTags.splice(tagsIndex, 1)[0]);\n        if ((!selectedLength && selectedTags.length > 0)) {\n            window.console.log('tags reversed1');\n            tagsReverseState = !tagsReverseState;\n        }\n    } else {\n        const tagsIndex = selectedTags.findIndex(value => value.id == tagsId);\n        selectableTags.push(selectedTags.splice(tagsIndex, 1)[0]);\n        if ((selectedLength && selectedTags.length === 0)) {\n            window.console.log('tags reversed2');\n            tagsReverseState = !tagsReverseState;\n        }\n    }\n    return Templates.renderForPromise(template, {\n        tags: selectableTags,\n        tagsselections: selectedTags,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownDiv, html, js);\n        const tagsDropdown = page.querySelector(dropdown);\n        tagsDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Handles UI changes when switching between customfield inputs.\n *\n * @param {string} newCurrentId The ID of the newly focused custom field.\n */\nfunction handleCustomfieldSwitch(newCurrentId) {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const customfieldDropdowns = page.querySelectorAll(SELECTORS.customfields.dropdownAll);\n\n    // Close other dropdowns.\n    customfieldDropdowns.forEach(dropdown => {\n        if (!dropdown.classList.contains(SELECTORS.customfields.dropdown + newCurrentId)) {\n            dropdown.style.display = 'none';\n        }\n    });\n\n    // Update classes for other fields.\n    customfields.forEach((v, i) => {\n        if (i != newCurrentId) {\n            const customFields = document.getElementsByClassName('collapse-cfid-' + i);\n            const collapseDisabled = (selectedCustomfields[i] !== undefined && selectedCustomfields[i].length);\n            Array.from(customFields).forEach(cf => {\n                if (collapseDisabled) {\n                    cf.classList.remove('collapse-enabled');\n                } else if (!cf.classList.contains('collapse-enabled')) {\n                    cf.classList.add('collapse-enabled');\n                }\n            });\n        }\n    });\n}\n\n/**\n * Hide customfield dropdown if clicked outside customfield search.\n *\n * @param {PointerEvent} e a click.\n */\nfunction manageCustomfielddropdownCollapse(e) {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const customfieldDropdowns = page.querySelectorAll(SELECTORS.customfields.dropdownAll);\n    const customfieldInputs = page.querySelectorAll(SELECTORS.customfields.input);\n\n    // We don't want to close the dropdown if clicking inside it or the input field.\n    for (const dropdown of customfieldDropdowns) {\n        if (dropdown.contains(e.target)) {\n            return;\n        }\n    }\n    for (const input of customfieldInputs) {\n        if (input.contains(e.target)) {\n            return;\n        }\n    }\n    const clearIcons = page.querySelectorAll(SELECTORS.customfields.clearIcon);\n    for (const icon of clearIcons) {\n        if (icon.contains(e.target)) {\n            return;\n        }\n    }\n\n    window.console.log('manageCustomfielddropdownCollapse');\n    customReverseState = false;\n\n    customfieldDropdowns.forEach(dropdown => {\n        dropdown.style.display = 'none';\n    });\n\n    customfields.forEach((v, i) => {\n        const customFields = document.getElementsByClassName('collapse-cfid-' + i);\n        const collapseDisabled = (selectedCustomfields[i] !== undefined && selectedCustomfields[i].length);\n        Array.from(customFields).forEach(cf => {\n            if (collapseDisabled) {\n                cf.classList.remove('collapse-enabled');\n            } else if (!cf.classList.contains('collapse-enabled')) {\n                cf.classList.add('collapse-enabled');\n            }\n        });\n    });\n}\n\n/**\n * Hide customfield dropdown if clicked outside customfield search.\n *\n * @param {PointerEvent} e a click.\n * @param {string} selected\n * @param {string} selectable\n * @param {string} dropdownDiv\n * @param {string} dropdown\n * @param {object} dropdownHelper\n * @param {object} page\n **/\nconst manageCustomfielddropdownItems = (e, selected, selectable, dropdownDiv, dropdown, dropdownHelper, page) => {\n    // const template = 'block_eledia_telc_coursesearch/nav-customfield-dropdown';\n    const customfieldValue = e.target.dataset.selectvalue;\n    const customfieldName = e.target.dataset.selectname;\n    const customfieldId = e.target.dataset.customfieldid;\n    const selectedLength = selectedCustomfields[customfieldId].length;\n    // dropdownDiv = dropdownHelper('customfields', dropdownDiv);\n    // dropdown = dropdownHelper('customfields', dropdown);\n    window.console.log('manageCustomfielddropdownItems');\n    window.console.log(customfieldId);\n    if (e.target.classList.contains(selectable)) {\n        const customfieldIndex = filteredCustomfields[customfieldId].findIndex(item => item.value == customfieldValue);\n        selectedCustomfields[customfieldId].push(filteredCustomfields[customfieldId].splice(customfieldIndex, 1)[0]);\n        selectedCustomfields[customfieldId].sort((a, b) => {\n            return ('' + a.name).localeCompare(b.name);\n        });\n\n        if ((!selectedLength && selectedCustomfields[customfieldId].length > 0)) {\n            window.console.log('customfields reversed1');\n            customReverseState = !customReverseState;\n        }\n    } else if (e.target.classList.contains(selected)) {\n        const customfieldIndex = selectedCustomfields[customfieldId].findIndex(item => item.value == customfieldValue);\n        const interchangedValue = selectedCustomfields[customfieldId].splice(customfieldIndex, 1)[0];\n        // customfields[customfieldId].push(interchangedValue);\n        const searchField = page.querySelector(\".customsearch-\" + customfieldId);\n        window.console.log('searchField');\n        window.console.log(searchField);\n        if (searchField.value === '' || customfieldName.toLowerCase().includes(searchField.value.trim().toLowerCase())) {\n            filteredCustomfields[customfieldId].push(interchangedValue);\n        }\n        filteredCustomfields[customfieldId].sort((a, b) => {\n            return ('' + a.name).localeCompare(b.name);\n        });\n        if ((selectedLength && selectedCustomfields[customfieldId].length === 0)) {\n            window.console.log('customfields reversed2');\n            customReverseState = !customReverseState;\n        }\n    }\n    // return renderCustomfields(dropdownDiv,\n    //     dropdown,\n    //     filteredCustomfields[customfieldId],\n    //     selectedCustomfields[customfieldId],\n    //     page);\n    const dropdowns = dropdownHelper('customfields', dropdownDiv, true);\n    return dropdowns.forEach(ddiv => {\n\n        return renderCustomfields(ddiv,\n            dropdown,\n            filteredCustomfields[customfieldId],\n            selectedCustomfields[customfieldId],\n            page);\n    });\n};\n\n/**\n * Intialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n */\nexport const init = root => {\n    // TODO: include course categories custom fields.\n    root = $(root);\n    loadedPages = [];\n    lastPage = 0;\n    courseOffset = 0;\n\n    if (!root.attr('data-init')) {\n        const page = document.querySelector(SELECTORS.region.selectBlock);\n        registerEventListeners(root, page);\n        namespace = \"block_eledia_telc_coursesearch_\" + root.attr('id') + \"_\" + Math.random();\n        root.attr('data-init', true);\n    }\n\n    initializePagedContent(root, standardFunctionalityCurry(), null, getParams());\n};\n\n/**\n * Reset the courses views to their original\n * state on first page load.courseOffset\n *\n * This is called when configuration has changed for the event lists\n * to cause them to reload their data.\n *\n * @param {Object} root The root element for the timeline view.\n */\nexport const reset = root => {\n    // TODO: Include categories and custom fields. May be included automatically.\n    if (loadedPages.length > 0) {\n        const filters = getFilterValues(root);\n        // If the display mode is changed to 'summary' but the summary display has not been loaded yet,\n        // we need to re-fetch the courses to include the course summary text.\n        if (filters.display === 'summary' && !summaryDisplayLoaded) {\n            const page = document.querySelector(SELECTORS.region.selectBlock);\n            const input = page.querySelector(SELECTORS.region.searchInput);\n            if (input.value !== '') {\n                initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\n            } else {\n                initializePagedContent(root, standardFunctionalityCurry());\n            }\n        } else {\n            loadedPages.forEach((courseList, index) => {\n                let pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then((html, js) => {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        }\n    } else {\n        init(root);\n    }\n};\n"],"names":["TEMPLATES","GROUPINGS","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","selectedCategories","selectableCategories","selectedTags","selectableTags","customfields","filteredCustomfields","selectedCustomfields","searchTerm","catSearchTerm","tagsSearchTerm","courseInProgress","currentCustomField","tagsReverseState","customReverseState","catReverseState","summaryDisplayLoaded","getFilterValues","root","courseRegion","find","SELECTORS","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","getAllFilterValues","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getParams","limit","params","criteria","key","value","categories","getCustomFields","tags","addsubcategories","length","map","values","undefined","fieldid","fieldvalues","val","filter","Boolean","getFavouriteIconContainer","courseId","FAVOURITE_ICON","getPagedContentContainer","index","getCourseId","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","PubSub","publish","CourseEvents","favourited","removeClass","addClass","iconContainer","isFavouriteIcon","ICON_IS_FAVOURITE","Aria","unhide","notFavourteIcon","ICON_NOT_FAVOURITE","hide","showFavouriteIcon","Notification","alert","catch","exception","removeFromFavourites","unfavorited","hideFavouriteIcon","getHideCourseMenuItem","getShowCourseMenuItem","setCourseHiddenState","status","hideElement","id","pagingBar","jumpto","parseInt","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","courseList","popElement","pagedContentContainer","PagedContentFactory","resetLastPageNumber","pagedContentPage","renderCourses","html","js","Templates","replaceNodeContents","remove","Repository","setFavouriteCourses","result","warnings","course","isfavourite","noCoursesRender","nocoursesimg","newcourseurl","render","coursesData","filters","currentTemplate","Array","isArray","Object","showcoursecategory","renderCustomfields","dropdownDiv","dropdown","customfieldsData","selectionsData","page","dropdownObject","document","querySelector","window","console","log","renderForPromise","customvalues","customselections","customfieldid","description","dataset","_ref3","renderResult","cuDropdowns","querySelectorAll","cuDropdown","style","error","registerPagedEventHandlers","event","PagedContentEvents","SET_ITEMS_PER_PAGE_LIMIT","subscribe","setLimit","itemsPerPageFunc","pagingLimit","itemsPerPage","active","totalCourseCount","pagingOption","pageBuilder","currentPage","pageData","actions","activeSearch","nextPageStart","pageCourses","currentPageLength","remainingCourses","allItemsLoaded","nextoffset","resetGlobals","standardFunctionalityCurry","promises","searchParams","pagePromise","offset","classification","requiredfields","SUMMARY_REQUIRED_FIELDS","CARDLIST_REQUIRED_FIELDS","getEnrolledCoursesByTimeline","getMyCourses","searchFunctionalityCurry","inputValue","searchingPromise","searchValue","searchvalue","getSearchMyCourses","trim","c","word","summary","fullname","escapedWord","replace","regex","RegExp","catSearchFunctionality","dropdownContainer","dropdownHelper","getCategories","getSearchCategories","categoriesData","selected","categoryIndex","findIndex","item","splice","ddc","catselections","_ref","cdd","renderCategories","tagsSearchFunctionality","getTags","getSearchTags","tagsData","tagsIndex","tagsselections","_ref2","renderTags","customfieldSearchFunctionality","searchterm","getCustomfields","getSearchCustomfields","noneOptionIndex","option","customfieldIndex","name","toLowerCase","includes","ddiv","initializePagedContent","promiseFunction","config","eventNamespace","pagedContentPromise","createWithLimit","pagesData","pageNumber","initializeCategorySearchContent","initializeTagsSearchContent","initializeCustomfieldSearchContent","$customfields","registerEventListeners","CustomEvents","define","events","activate","on","ACTION_ADD_FAVOURITE","e","data","favourite","target","closest","originalEvent","preventDefault","ACTION_REMOVE_FAVOURITE","ACTION_HIDE_COURSE","hideAction","showAction","hideCourse","ACTION_SHOW_COURSE","showCourse","input","searchInput","clearIcons","clearIcon","catinputs","cat","tagsinputs","customInputs","clearCatIcons","clearTagsIcons","clearCustomfieldIcons","customClass","searchfield","catSelectable","selectableItem","catSelected","selectedItem","tagsSelectable","tagsSelected","customfieldSelectable","customfieldSelected","groupingFilter","FILTER_GROUPING","copyCatValues","ci","copyTagsValues","ti","icon","addEventListener","focus","clearSearch","catinput","i","clearCatSearch","tagsinput","customfieldInputs","customfieldInput","clearCustomfieldSingleIconSearch","newCurrentId","selectBlock","dropdownAll","classList","contains","v","customFields","getElementsByClassName","collapseDisabled","from","cf","add","handleCustomfieldSwitch","currentSearchterm","clearCustomfieldSearch","manageCustomfielddropdownItems","activeCustomfieldSearch","body","manageCategorydropdownCollapse","manageTagsdropdownCollapse","manageCustomfielddropdownCollapse","manageCategorydropdownItems","manageTagsdropdownItems","currentId","expandLink","previousElementSibling","parentElement","nextElementSibling","filterType","dataSource","selector","parts","reverseState","all","collapse","noCollapse","split","Error","customfieldClass","init","clearCatIcon","catDropdowns","catInputs","catSelectElements","tagsDropdowns","tagsInputs","tagsSelectElements","selectable","categoryId","catId","selectedLength","_ref4","tagsId","_ref5","customfieldDropdowns","customfieldValue","selectvalue","customfieldName","selectname","customfieldId","a","b","localeCompare","interchangedValue","searchField","Math","random"],"mappings":"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"}