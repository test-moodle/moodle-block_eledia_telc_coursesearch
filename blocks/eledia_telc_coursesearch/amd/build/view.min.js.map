{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//import $, { error } from 'jquery';\nimport $ from 'jquery';\nimport * as Repository from 'block_eledia_telc_coursesearch/repository';\nimport * as PagedContentFactory from 'core/paged_content_factory';\nimport * as PubSub from 'core/pubsub';\nimport * as CustomEvents from 'core/custom_interaction_events';\nimport * as Notification from 'core/notification';\nimport { exception as displayException } from 'core/notification';\nimport * as Templates from 'core/templates';\nimport * as CourseEvents from 'core_course/events';\nimport SELECTORS from 'block_eledia_telc_coursesearch/selectors';\nimport * as PagedContentEvents from 'core/paged_content_events';\nimport * as Aria from 'core/aria';\nimport { debounce } from 'core/utils';\nimport { setUserPreference } from 'core_user/repository';\n\nconst TEMPLATES = {\n        COURSES_CARDS: 'block_eledia_telc_coursesearch/view-cards',\n        COURSES_LIST: 'block_eledia_telc_coursesearch/view-list',\n        COURSES_SUMMARY: 'block_eledia_telc_coursesearch/view-summary',\n        NOCOURSES: 'core_course/no-courses'\n};\n\nconst GROUPINGS = {\n        GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n        GROUPING_ALL: 'all',\n        GROUPING_INPROGRESS: 'inprogress',\n        GROUPING_FUTURE: 'future',\n        GROUPING_PAST: 'past',\n        GROUPING_FAVOURITES: 'favourites',\n        GROUPING_HIDDEN: 'hidden'\n};\n\nconst NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\n\nlet loadedPages = [];\n\nlet courseOffset = 0;\n\nlet lastPage = 0;\n\nlet lastLimit = 0;\n\nlet namespace = null;\n\n/**\n * Whether the summary display has been loaded.\n *\n * If true, this means that courses have been loaded with the summary text.\n * Otherwise, switching to the summary display mode will require course data to be fetched with the summary text.\n *\n * @type {boolean}\n */\nlet summaryDisplayLoaded = false;\n\n/**\n * Get filter values from DOM.\n *\n * @param {object} root The root element for the courses view.\n * @return {filters} Set filters.\n */\nconst getFilterValues = root => {\n        const courseRegion = root.find(SELECTORS.courseView.region);\n        return {\n                display: courseRegion.attr('data-display'),\n                grouping: courseRegion.attr('data-grouping'),\n                sort: courseRegion.attr('data-sort'),\n                displaycategories: courseRegion.attr('data-displaycategories'),\n                customfieldname: courseRegion.attr('data-customfieldname'),\n                customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n        };\n};\n\n// We want the paged content controls below the paged content area.\n// and the controls should be ignored while data is loading.\nconst DEFAULT_PAGED_CONTENT_CONFIG = {\n        ignoreControlWhileLoading: true,\n        controlPlacementBottom: true,\n        persistentLimitKey: 'block_eledia_telc_coursesearch_user_paging_preference'\n};\n\n/**\n * Get enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @return {promise} Resolved with an array of courses.\n */\nconst getMyCourses = (filters, limit) => {\n        const params = {\n                offset: courseOffset,\n                limit: limit,\n                classification: filters.grouping,\n                sort: filters.sort,\n                customfieldname: filters.customfieldname,\n                customfieldvalue: filters.customfieldvalue,\n        };\n        if (filters.display === 'summary') {\n                params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\n                summaryDisplayLoaded = true;\n        } else {\n                params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\n        }\n        return Repository.getEnrolledCoursesByTimeline(params);\n};\n\n/**\n * Search for enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @param {string} searchValue What does the user want to search within their courses.\n * @return {promise} Resolved with an array of courses.\n */\nconst getSearchMyCourses = (filters, limit, searchValue) => {\n        const params = {\n                offset: courseOffset,\n                limit: limit,\n                classification: 'search',\n                sort: filters.sort,\n                customfieldname: filters.customfieldname,\n                customfieldvalue: filters.customfieldvalue,\n                searchvalue: searchValue,\n        };\n        if (filters.display === 'summary') {\n                params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\n                summaryDisplayLoaded = true;\n        } else {\n                params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\n                summaryDisplayLoaded = false;\n        }\n        return Repository.getEnrolledCoursesByTimeline(params);\n};\n\n/**\n * Search for categories from backend.\n *\n * @param {string} key filters The filters for this view.\n * @param {string} searchValue What does the user want to search within the categoies names.\n * @param {boolean} subCategories search for sub categories\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchCategories = (key, searchValue, subCategories) => {\n        const params = {\n                // NOTE: It might be beneficial to allow multiple criteria of the core supported ones.\n                //criteria: [\n                //        {\n                //                key: key,\n                //                value: searchValue,\n                //        }\n                //],\n                //addsubcategories: subCategories,\n                criteria: [\n                ],\n                addsubcategories: subCategories,\n        };\n        return Repository.getCategories(params);\n};\n\n/**\n * Get the container element for the favourite icon.\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n * @return {Object} The favourite icon container\n */\nconst getFavouriteIconContainer = (root, courseId) => {\n        return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the paged content container element.\n *\n * @param {Object} root The course overview container\n * @param {Number} index Rendered page index.\n * @return {Object} The rendered paged container.\n */\nconst getPagedContentContainer = (root, index) => {\n        return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n};\n\n/**\n * Get the course id from a favourite element.\n *\n * @param {Object} root The favourite icon container element.\n * @return {Number} Course id.\n */\nconst getCourseId = root => {\n        return root.attr('data-course-id');\n};\n\n/**\n * Hide the favourite icon.\n *\n * @param {Object} root The favourite icon container element.\n * @param {Number} courseId Course id number.\n */\nconst hideFavouriteIcon = (root, courseId) => {\n        const iconContainer = getFavouriteIconContainer(root, courseId);\n\n        const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.addClass('hidden');\n        Aria.hide(isFavouriteIcon);\n\n        const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.removeClass('hidden');\n        Aria.unhide(notFavourteIcon);\n};\n\n/**\n * Show the favourite icon.\n *\n * @param {Object} root The course overview container.\n * @param {Number} courseId Course id number.\n */\nconst showFavouriteIcon = (root, courseId) => {\n        const iconContainer = getFavouriteIconContainer(root, courseId);\n\n        const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.removeClass('hidden');\n        Aria.unhide(isFavouriteIcon);\n\n        const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.addClass('hidden');\n        Aria.hide(notFavourteIcon);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The add to favourite menu item.\n */\nconst getAddFavouriteMenuItem = (root, courseId) => {\n        return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The remove from favourites menu item.\n */\nconst getRemoveFavouriteMenuItem = (root, courseId) => {\n        return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Add course to favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst addToFavourites = (root, courseId) => {\n        const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        const addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, true).then(success => {\n                if (success) {\n                        PubSub.publish(CourseEvents.favourited, courseId);\n                        removeAction.removeClass('hidden');\n                        addAction.addClass('hidden');\n                        showFavouriteIcon(root, courseId);\n                } else {\n                        Notification.alert('Starring course failed', 'Could not change favourite state');\n                }\n                return;\n        }).catch(Notification.exception);\n};\n\n/**\n * Remove course from favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst removeFromFavourites = (root, courseId) => {\n        const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        const addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, false).then(success => {\n                if (success) {\n                        PubSub.publish(CourseEvents.unfavorited, courseId);\n                        removeAction.addClass('hidden');\n                        addAction.removeClass('hidden');\n                        hideFavouriteIcon(root, courseId);\n                } else {\n                        Notification.alert('Starring course failed', 'Could not change favourite state');\n                }\n                return;\n        }).catch(Notification.exception);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The hide course menu item.\n */\nconst getHideCourseMenuItem = (root, courseId) => {\n        return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The show course menu item.\n */\nconst getShowCourseMenuItem = (root, courseId) => {\n        return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Hide course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst hideCourse = (root, courseId) => {\n        const hideAction = getHideCourseMenuItem(root, courseId);\n        const showAction = getShowCourseMenuItem(root, courseId);\n        const filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, true);\n\n        // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n        // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n        if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n                hideElement(root, courseId);\n        }\n\n        hideAction.addClass('hidden');\n        showAction.removeClass('hidden');\n};\n\n/**\n * Show course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst showCourse = (root, courseId) => {\n        const hideAction = getHideCourseMenuItem(root, courseId);\n        const showAction = getShowCourseMenuItem(root, courseId);\n        const filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, null);\n\n        // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n        // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n        if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n                hideElement(root, courseId);\n        }\n\n        hideAction.removeClass('hidden');\n        showAction.addClass('hidden');\n};\n\n/**\n * Set the courses hidden status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {Boolean} status new hidden status.\n * @return {Promise} Repository promise.\n */\nconst setCourseHiddenState = (courseId, status) => {\n\n        // If the given status is not hidden, the preference has to be deleted with a null value.\n        if (status === false) {\n                status = null;\n        }\n\n        return setUserPreference(`block_eledia_telc_coursesearch_hidden_course_${courseId}`, status)\n                .catch(Notification.exception);\n};\n\n/**\n * Reset the loadedPages dataset to take into account the hidden element\n *\n * @param {Object} root The course overview container\n * @param {Number} id The course id number\n */\nconst hideElement = (root, id) => {\n        const pagingBar = root.find('[data-region=\"paging-bar\"]');\n        const jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n        // Get a reduced dataset for the current page.\n        const courseList = loadedPages[jumpto];\n        let reducedCourse = courseList.courses.reduce((accumulator, current) => {\n                if (+id !== +current.id) {\n                        accumulator.push(current);\n                }\n                return accumulator;\n        }, []);\n\n        // Get the next page's data if loaded and pop the first element from it.\n        if (typeof (loadedPages[jumpto + 1]) !== 'undefined') {\n                const newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n                // Adjust the dataset for the reset of the pages that are loaded.\n                loadedPages.forEach((courseList, index) => {\n                        if (index > jumpto) {\n                                let popElement = [];\n                                if (typeof (loadedPages[index + 1]) !== 'undefined') {\n                                        popElement = loadedPages[index + 1].courses.slice(0, 1);\n                                }\n                                loadedPages[index].courses = [...loadedPages[index].courses.slice(1), ...popElement];\n                        }\n                });\n\n                reducedCourse = [...reducedCourse, ...newElement];\n        }\n\n        // Check if the next page is the last page and if it still has data associated to it.\n        if (lastPage === jumpto + 1 && loadedPages[jumpto + 1].courses.length === 0) {\n                const pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n                PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n        }\n\n        loadedPages[jumpto].courses = reducedCourse;\n\n        // Reduce the course offset.\n        courseOffset--;\n\n        // Render the paged content for the current.\n        const pagedContentPage = getPagedContentContainer(root, jumpto);\n        renderCourses(root, loadedPages[jumpto]).then((html, js) => {\n                return Templates.replaceNodeContents(pagedContentPage, html, js);\n        }).catch(Notification.exception);\n\n        // Delete subsequent pages in order to trigger the callback.\n        loadedPages.forEach((courseList, index) => {\n                if (index > jumpto) {\n                        const page = getPagedContentContainer(root, index);\n                        page.remove();\n                }\n        });\n};\n\n/**\n * Set the courses favourite status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {boolean} status new favourite status.\n * @return {Promise} Repository promise.\n */\nconst setCourseFavouriteState = (courseId, status) => {\n\n        return Repository.setFavouriteCourses({\n                courses: [\n                        {\n                                'id': courseId,\n                                'favourite': status\n                        }\n                ]\n        }).then(result => {\n                if (result.warnings.length === 0) {\n                        loadedPages.forEach(courseList => {\n                                courseList.courses.forEach((course, index) => {\n                                        if (course.id == courseId) {\n                                                courseList.courses[index].isfavourite = status;\n                                        }\n                                });\n                        });\n                        return true;\n                } else {\n                        return false;\n                }\n        }).catch(Notification.exception);\n};\n\n/**\n * Given there are no courses to render provide the rendered template.\n *\n * @param {object} root The root element for the courses view.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst noCoursesRender = root => {\n        const nocoursesimg = root.find(SELECTORS.courseView.region).attr('data-nocoursesimg');\n        const newcourseurl = root.find(SELECTORS.courseView.region).attr('data-newcourseurl');\n        return Templates.render(TEMPLATES.NOCOURSES, {\n                nocoursesimg: nocoursesimg,\n                newcourseurl: newcourseurl\n        });\n};\n\n/**\n * Render the dashboard courses.\n *\n * @param {object} root The root element for the courses view.\n * @param {array} coursesData containing array of returned courses.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCourses = (root, coursesData) => {\n\n        const filters = getFilterValues(root);\n\n        let currentTemplate = '';\n        if (filters.display === 'card') {\n                currentTemplate = TEMPLATES.COURSES_CARDS;\n        } else if (filters.display === 'list') {\n                currentTemplate = TEMPLATES.COURSES_LIST;\n        } else {\n                currentTemplate = TEMPLATES.COURSES_SUMMARY;\n        }\n\n        if (!coursesData) {\n                return noCoursesRender(root);\n        } else {\n                // Sometimes we get weird objects coming after a failed search, cast to ensure typing functions.\n                if (Array.isArray(coursesData.courses) === false) {\n                        coursesData.courses = Object.values(coursesData.courses);\n                }\n                // Whether the course category should be displayed in the course item.\n                coursesData.courses = coursesData.courses.map(course => {\n                        course.showcoursecategory = filters.displaycategories === 'on';\n                        return course;\n                });\n                if (coursesData.courses.length) {\n                        return Templates.render(currentTemplate, {\n                                courses: coursesData.courses,\n                        });\n                } else {\n                        return noCoursesRender(root);\n                }\n        }\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownContainer The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} categoriesData containing array of returned courses.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCategories = (dropdownContainer, dropdown, categoriesData, page) => { // eslint-disable-line\n\n        // const filters = getFilterValues(categories);\n\n        const template = 'block_eledia_telc_coursesearch/nav-category-dropdown';\n\n        if (!categoriesData) {\n                // TODO: Make function for empty result or solve it here.\n                window.console.log('!categoriesData');\n                window.console.log(categoriesData);\n                // return noCoursesRender(categories);\n        } else {\n                // TODO: Render template with data. Mustache template should be able to make the data work by itself.\n                // Sometimes we get weird objects coming after a failed search, cast to ensure typing functions.\n                //if (Array.isArray(categoriesData.data) === false) {\n                //        categoriesData.data = Object.values(categoriesData.data);\n                //}\n                // Whether the course category should be displayed in the course item.\n                // if (categoriesData.data.length) {\n                if (categoriesData) {\n                        // NOTE: Render function for mustache.\n                        window.console.log('render categoriesData');\n                        return Templates.renderForPromise(template, {\n                                categories: categoriesData,\n                        }).then(({ html, js }) => {\n                                window.console.log('replaceNodeContents');\n                                window.console.log(html);\n                                window.console.log(js);\n                                const renderResult = Templates.replaceNodeContents(dropdownContainer, html, js);\n                                const catDropdown = page.querySelector(dropdown);\n                                catDropdown.style.display = 'block';\n                                return renderResult;\n                        }).catch(error => displayException(error));\n\n                } else {\n                        window.console.log('no render categoriesData false');\n                        // return noCoursesRender(categories);\n                        return false;\n                }\n        }\n};\n\n/**\n * Return the callback to be passed to the subscribe event\n *\n * @param {object} root The root element for the courses view\n * @return {function} Partially applied function that'll execute when passed a limit\n */\nconst setLimit = root => {\n        // @param {Number} limit The paged limit that is passed through the event.\n        return limit => root.find(SELECTORS.courseView.region).attr('data-paging', limit);\n};\n\n/**\n * Intialise the paged list and cards views on page load.\n * Returns an array of paged contents that we would like to handle here\n *\n * @param {object} root The root element for the courses view\n * @param {string} namespace The namespace for all the events attached\n */\nconst registerPagedEventHandlers = (root, namespace) => {\n        const event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n        PubSub.subscribe(event, setLimit(root));\n};\n\n/**\n * Figure out how many items are going to be allowed to be rendered in the block.\n *\n * @param  {Number} pagingLimit How many courses to display\n * @param  {Object} root The course overview container\n * @return {Number[]} How many courses will be rendered\n */\nconst itemsPerPageFunc = (pagingLimit, root) => {\n        let itemsPerPage = NUMCOURSES_PERPAGE.map(value => {\n                let active = false;\n                if (value === pagingLimit) {\n                        active = true;\n                }\n\n                return {\n                        value: value,\n                        active: active\n                };\n        });\n\n        // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n        const totalCourseCount = parseInt(root.find(SELECTORS.courseView.region).attr('data-totalcoursecount'), 10);\n        return itemsPerPage.filter(pagingOption => {\n                if (pagingOption.value === 0 && totalCourseCount > 100) {\n                        // To minimise performance issues, do not show the \"All\" option\n                        // if the user is enrolled in more than 100 courses.\n                        return false;\n                }\n                return pagingOption.value < totalCourseCount;\n        });\n};\n\n/**\n * Mutates and controls the loadedPages array and handles the bootstrapping.\n *\n * @param {Array|Object} coursesData Array of all of the courses to start building the page from\n * @param {Number} currentPage What page are we currently on?\n * @param {Object} pageData Any current page information\n * @param {Object} actions Paged content helper\n * @param {null|boolean} activeSearch Are we currently actively searching and building up search results?\n */\nconst pageBuilder = (coursesData, currentPage, pageData, actions, activeSearch = null) => {\n        // TODO: Examine how mustache is populated.\n        // If the courseData comes in an object then get the value otherwise it is a pure array.\n        let courses = coursesData.courses ? coursesData.courses : coursesData;\n        let nextPageStart = 0;\n        let pageCourses = [];\n\n        // If current page's data is loaded make sure we max it to page limit.\n        if (typeof (loadedPages[currentPage]) !== 'undefined') {\n                pageCourses = loadedPages[currentPage].courses;\n                const currentPageLength = pageCourses.length;\n                if (currentPageLength < pageData.limit) {\n                        nextPageStart = pageData.limit - currentPageLength;\n                        pageCourses = { ...loadedPages[currentPage].courses, ...courses.slice(0, nextPageStart) };\n                }\n        } else {\n                // When the page limit is zero, there is only one page of courses, no start for next page.\n                nextPageStart = pageData.limit || false;\n                pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n        }\n\n        // Finished setting up the current page.\n        loadedPages[currentPage] = {\n                courses: pageCourses\n        };\n\n        // Set up the next page (if there is more than one page).\n        const remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n        if (remainingCourses.length) {\n                loadedPages[currentPage + 1] = {\n                        courses: remainingCourses\n                };\n        }\n\n        // Set the last page to either the current or next page.\n        if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n                lastPage = currentPage;\n                if (activeSearch === null) {\n                        actions.allItemsLoaded(currentPage);\n                }\n        } else if (typeof (loadedPages[currentPage + 1]) !== 'undefined'\n                && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n                lastPage = currentPage + 1;\n        }\n\n        courseOffset = coursesData.nextoffset;\n};\n\n// TODO: Some function like the above to filter our category names and ids from the search results.\n\n/**\n * In cases when switching between regular rendering and search rendering we need to reset some variables.\n */\nconst resetGlobals = () => {\n        courseOffset = 0;\n        loadedPages = [];\n        lastPage = 0;\n        lastLimit = 0;\n};\n\n/**\n * The default functionality of fetching paginated courses without special handling.\n *\n * @return {function(Object, Object, Object, Object, Object, Promise, Number): void}\n */\nconst standardFunctionalityCurry = () => {\n        resetGlobals();\n        return (filters, currentPage, pageData, actions, root, promises, limit) => {\n                const pagePromise = getMyCourses(\n                        filters,\n                        limit\n                ).then(coursesData => {\n                        pageBuilder(coursesData, currentPage, pageData, actions);\n                        return renderCourses(root, loadedPages[currentPage]);\n                }).catch(Notification.exception);\n\n                promises.push(pagePromise);\n        };\n};\n\n/**\n * Initialize the searching functionality so we can call it when required.\n *\n * @return {function(Object, Number, Object, Object, Object, Promise, Number, String): void}\n */\nconst searchFunctionalityCurry = () => {\n        resetGlobals();\n        return (filters, currentPage, pageData, actions, root, promises, limit, inputValue) => {\n                const searchingPromise = getSearchMyCourses(\n                        filters,\n                        limit,\n                        inputValue\n                ).then(coursesData => {\n                        pageBuilder(coursesData, currentPage, pageData, actions);\n                        return renderCourses(root, loadedPages[currentPage]);\n                }).catch(Notification.exception);\n\n                promises.push(searchingPromise);\n        };\n};\n\n/**\n * Initialize the categoy searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst catSearchFunctionality = () => {\n        return (dropdownContainer, dropdown, page, inputValue) => {\n                const searchingPromise = getSearchCategories(\n                        \"name\",\n                        inputValue,\n                        true\n                ).then(categoriesData => {\n                        // NOTE: Here it goes.\n                        return renderCategories(dropdownContainer, dropdown, categoriesData, page);\n                        //pageBuilder(categoriesData, actions);\n                        //return renderCategories(root, loadedPages[currentPage]);\n                }).catch(Notification.exception);\n\n                // promises.push(searchingPromise);\n                // window.console.log(searchingPromise);\n                return searchingPromise;\n        };\n};\n\n/**\n * Initialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n * @param {function} promiseFunction How do we fetch the courses and what do we do with them?\n * @param {null | string} inputValue What to search for\n */\nconst initializePagedContent = (root, promiseFunction, inputValue = null) => {\n        const pagingLimit = parseInt(root.find(SELECTORS.courseView.region).attr('data-paging'), 10);\n        let itemsPerPage = itemsPerPageFunc(pagingLimit, root);\n\n        const config = { ...{}, ...DEFAULT_PAGED_CONTENT_CONFIG };\n        config.eventNamespace = namespace;\n\n        const pagedContentPromise = PagedContentFactory.createWithLimit(\n                itemsPerPage,\n                (pagesData, actions) => {\n                        let promises = [];\n                        pagesData.forEach(pageData => {\n                                const currentPage = pageData.pageNumber;\n                                let limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                                // Reset local variables if limits have changed.\n                                if (+lastLimit !== +limit) {\n                                        loadedPages = [];\n                                        courseOffset = 0;\n                                        lastPage = 0;\n                                }\n\n                                if (lastPage === currentPage) {\n                                        // If we are on the last page and have it's data then load it from cache.\n                                        actions.allItemsLoaded(lastPage);\n                                        promises.push(renderCourses(root, loadedPages[currentPage]));\n                                        return;\n                                }\n\n                                lastLimit = limit;\n\n                                // Get 2 pages worth of data as we will need it for the hidden functionality.\n                                if (typeof (loadedPages[currentPage + 1]) === 'undefined') {\n                                        if (typeof (loadedPages[currentPage]) === 'undefined') {\n                                                limit *= 2;\n                                        }\n                                }\n\n                                // Get the current applied filters.\n                                const filters = getFilterValues(root);\n\n                                // Call the curried function that'll handle the course promise and any manipulation of it.\n                                promiseFunction(filters, currentPage, pageData, actions, root, promises, limit, inputValue);\n                        });\n                        return promises;\n                },\n                config\n        );\n\n        pagedContentPromise.then((html, js) => {\n                registerPagedEventHandlers(root, namespace);\n                return Templates.replaceNodeContents(root.find(SELECTORS.courseView.region), html, js);\n        }).catch(Notification.exception);\n};\n\n// TODO: Make own function to populate the category search.\n/**\n * Initialise the list of categories in the search dropdown.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {object} page The page object.\n * @param {null | string} inputValue What to search for\n */\nconst initializeCategorySearchContent = (dropdownContainer, dropdown, promiseFunction, page, inputValue = null) => {// eslint-disable-line\n        const $categories = promiseFunction(dropdownContainer, dropdown, page, inputValue);\n        window.console.log($categories);\n};\n\n\n/**\n * Listen to, and handle events for the eledia_telc_coursesearch block.\n *\n * @param {Object} root The eledia_telc_coursesearch block container element.\n * @param {HTMLElement} page The whole HTMLElement for our block.\n */\nconst registerEventListeners = (root, page) => {\n\n        CustomEvents.define(root, [\n                CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, (e, data) => {\n                const favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n                const courseId = getCourseId(favourite);\n                addToFavourites(root, courseId);\n                data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, (e, data) => {\n                const favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n                const courseId = getCourseId(favourite);\n                removeFromFavourites(root, courseId);\n                data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, (e, data) => {\n                data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, (e, data) => {\n                const target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n                const courseId = getCourseId(target);\n                hideCourse(root, courseId);\n                data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, (e, data) => {\n                const target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n                const courseId = getCourseId(target);\n                showCourse(root, courseId);\n                data.originalEvent.preventDefault();\n        });\n\n        // Searching functionality event handlers.\n        const input = page.querySelector(SELECTORS.region.searchInput);\n        const clearIcon = page.querySelector(SELECTORS.region.clearIcon);\n        const catinput = page.querySelector(SELECTORS.cat.input);\n        const clearCatIcon = page.querySelector(SELECTORS.cat.clearIcon);\n\n        clearIcon.addEventListener('click', () => {\n                input.value = '';\n                input.focus();\n                clearSearch(clearIcon, root);\n        });\n\n        clearCatIcon.addEventListener('click', () => {\n                catinput.value = '';\n                catinput.focus();\n                clearCatSearch(clearCatIcon);\n        });\n\n        input.addEventListener('input', debounce(() => {\n                if (input.value === '') {\n                        clearSearch(clearIcon, root);\n                } else {\n                        activeSearch(clearIcon);\n                        initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\n                }\n        }, 1000));\n\n        // Listener for category search.\n        catinput.addEventListener('input', debounce(() => {\n                if (catinput.value === '') {\n                        clearCatSearch(clearCatIcon);\n                        initializeCategorySearchContent(\n                                SELECTORS.cat.dropdownDiv,\n                                SELECTORS.cat.dropdown,\n                                catSearchFunctionality(),\n                                page,\n                                '');\n                } else {\n                        activeSearch(clearCatIcon);\n                        initializeCategorySearchContent(\n                                SELECTORS.cat.dropdownDiv,\n                                SELECTORS.cat.dropdown,\n                                catSearchFunctionality(),\n                                page,\n                                catinput.value.trim());\n                }\n        }, 1000));\n\n        document.body.addEventListener('click', manageCategorydropdownCollapse);\n};\n\n/**\n * Reset the search icon and trigger the init for the block.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n * @param {Object} root The eledia_telc_coursesearch block container element.\n */\nexport const clearSearch = (clearIcon, root) => {\n        clearIcon.classList.add('d-none');\n        init(root);\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} clearCatIcon Our closing icon to manipulate.\n */\nexport const clearCatSearch = (clearCatIcon) => {\n        clearCatIcon.classList.add('d-none');\n        // TODO: Own init function if required.\n        // init(root);\n};\n\n/**\n * Change the searching icon to its' active state.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n */\nconst activeSearch = (clearIcon) => {\n        clearIcon.classList.remove('d-none');\n};\n\n/**\n * Hide category dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n */\nconst manageCategorydropdownCollapse = (e) => {\n        const page = document.querySelector(SELECTORS.region.selectBlock);\n        const catDropdown = page.querySelector(SELECTORS.cat.dropdown);\n        if (!e.target.classList.contains('catprevent') && !e.target.classList.contains('fa-xmark')) {\n                catDropdown.style.display = 'none';\n        } else {\n                catDropdown.style.display = 'block';\n        }\n\n};\n\n/**\n * Intialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n */\nexport const init = root => {\n        root = $(root);\n        loadedPages = [];\n        lastPage = 0;\n        courseOffset = 0;\n\n        if (!root.attr('data-init')) {\n                const page = document.querySelector(SELECTORS.region.selectBlock);\n                registerEventListeners(root, page);\n                namespace = \"block_eledia_telc_coursesearch_\" + root.attr('id') + \"_\" + Math.random();\n                root.attr('data-init', true);\n        }\n\n        initializePagedContent(root, standardFunctionalityCurry());\n};\n\n/**\n * Reset the courses views to their original\n * state on first page load.courseOffset\n *\n * This is called when configuration has changed for the event lists\n * to cause them to reload their data.\n *\n * @param {Object} root The root element for the timeline view.\n */\nexport const reset = root => {\n        if (loadedPages.length > 0) {\n                const filters = getFilterValues(root);\n                // If the display mode is changed to 'summary' but the summary display has not been loaded yet,\n                // we need to re-fetch the courses to include the course summary text.\n                if (filters.display === 'summary' && !summaryDisplayLoaded) {\n                        const page = document.querySelector(SELECTORS.region.selectBlock);\n                        const input = page.querySelector(SELECTORS.region.searchInput);\n                        if (input.value !== '') {\n                                initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\n                        } else {\n                                initializePagedContent(root, standardFunctionalityCurry());\n                        }\n                } else {\n                        loadedPages.forEach((courseList, index) => {\n                                let pagedContentPage = getPagedContentContainer(root, index);\n                                renderCourses(root, courseList).then((html, js) => {\n                                        return Templates.replaceNodeContents(pagedContentPage, html, js);\n                                }).catch(Notification.exception);\n                        });\n                }\n        } else {\n                init(root);\n        }\n};\n"],"names":["TEMPLATES","GROUPINGS","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","summaryDisplayLoaded","getFilterValues","root","courseRegion","find","SELECTORS","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getFavouriteIconContainer","courseId","FAVOURITE_ICON","getPagedContentContainer","index","getCourseId","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","PubSub","publish","CourseEvents","favourited","removeClass","addClass","iconContainer","isFavouriteIcon","ICON_IS_FAVOURITE","Aria","unhide","notFavourteIcon","ICON_NOT_FAVOURITE","hide","showFavouriteIcon","Notification","alert","catch","exception","removeFromFavourites","unfavorited","hideFavouriteIcon","getHideCourseMenuItem","getShowCourseMenuItem","setCourseHiddenState","status","hideElement","id","pagingBar","jumpto","parseInt","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","courseList","popElement","length","pagedContentContainer","PagedContentFactory","resetLastPageNumber","pagedContentPage","renderCourses","html","js","Templates","replaceNodeContents","remove","Repository","setFavouriteCourses","result","warnings","course","isfavourite","noCoursesRender","nocoursesimg","newcourseurl","render","coursesData","filters","currentTemplate","Array","isArray","Object","values","map","showcoursecategory","registerPagedEventHandlers","event","PagedContentEvents","SET_ITEMS_PER_PAGE_LIMIT","subscribe","limit","setLimit","itemsPerPageFunc","pagingLimit","itemsPerPage","value","active","totalCourseCount","filter","pagingOption","pageBuilder","currentPage","pageData","actions","activeSearch","nextPageStart","pageCourses","currentPageLength","remainingCourses","allItemsLoaded","nextoffset","resetGlobals","standardFunctionalityCurry","promises","pagePromise","params","offset","classification","requiredfields","SUMMARY_REQUIRED_FIELDS","CARDLIST_REQUIRED_FIELDS","getEnrolledCoursesByTimeline","getMyCourses","searchFunctionalityCurry","inputValue","searchingPromise","searchValue","searchvalue","getSearchMyCourses","catSearchFunctionality","dropdownContainer","dropdown","page","key","subCategories","criteria","addsubcategories","getCategories","getSearchCategories","categoriesData","window","console","log","renderForPromise","categories","_ref","renderResult","querySelector","style","error","renderCategories","initializePagedContent","promiseFunction","config","eventNamespace","pagedContentPromise","createWithLimit","pagesData","pageNumber","initializeCategorySearchContent","$categories","registerEventListeners","CustomEvents","define","events","activate","on","ACTION_ADD_FAVOURITE","e","data","favourite","target","closest","originalEvent","preventDefault","ACTION_REMOVE_FAVOURITE","ACTION_HIDE_COURSE","hideAction","showAction","hideCourse","ACTION_SHOW_COURSE","showCourse","input","searchInput","clearIcon","catinput","cat","clearCatIcon","addEventListener","focus","clearSearch","clearCatSearch","trim","dropdownDiv","document","body","manageCategorydropdownCollapse","classList","add","init","catDropdown","selectBlock","contains","Math","random"],"mappings":"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"}